<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - FBNHS-SHS</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

  <!-- JS libraries for Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { font-family: 'Poppins', sans-serif; display: flex; background: #f4f6f9; margin:0; }

    /* Sidebar */
    .sidebar {
      position: fixed; top: 0; left: 0; height: 100%; width: 250px;
      background: #f5f5f5; box-shadow: 2px 0 8px rgba(0,0,0,0.15);
      padding-top: 20px; transition: 0.3s;
    }
    .sidebar img { display:block; margin:0 auto 15px; width:80px; border-radius:50%;
      box-shadow:0 4px 8px rgba(0,0,0,0.2);}
    .sidebar h4 { text-align:center; margin-bottom:30px; color:#2d4c2d;}
    .sidebar a { display:block; padding:12px 20px; color:#333; text-decoration:none;
      font-weight:500; transition:0.3s;}
    .sidebar a:hover { background:#2d4c2d; color:white; }

    /* Content */
    .content { margin-left:250px; padding:30px; width:100%; }
    .section { padding:40px; background:white; margin-bottom:25px;
      border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
    .section h2 { font-weight:bold; margin-bottom:20px; color:#2d4c2d; }

    .btn-action { margin-right:10px; }
    .export-buttons { margin-top:15px; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <img src="logo.png" alt="FBNHS Logo">
    <h4>Admin Panel</h4>
    <a href="#dashboard"> Dashboard</a>
    <a href="#enrollees"> Enrollees</a>
    <a href="#masterlist"> Masterlist</a>
    <a href="#messages"> Messages</a>
    <a href="adminlogin.html"> Logout</a>
  </div>

  <!-- Content -->
  <div class="content">

    <!-- Dashboard -->
    <div id="dashboard" class="section">
      <h2>üìä Dashboard</h2>
      <div class="row text-center">
        <div class="col-md-4"><div class="p-4 bg-success text-white rounded">Total Enrollees<br><b id="totalEnrollees">0</b></div></div>
        <div class="col-md-4"><div class="p-4 bg-info text-white rounded">Male<br><b id="maleCount">0</b></div></div>
        <div class="col-md-4"><div class="p-4 bg-warning text-white rounded">Female<br><b id="femaleCount">0</b></div></div>
      </div>
    </div>

    <!-- Enrollees -->
    <div id="enrollees" class="section">
      <h2>üìù Enrollees</h2>
      <table class="table table-bordered" id="enrolleesTable">
        <thead class="thead-dark"><tr><th>LRN</th><th>Name</th><th>Track/Strand</th><th>Gender</th><th>Action</th></tr></thead>
        <tbody>
          <tr>
            <td>123456789012</td><td>Juan Dela Cruz</td><td>ABM</td><td>Male</td>
            <td><button class="btn btn-success btn-sm approve">Approve</button><button class="btn btn-danger btn-sm decline">Decline</button></td>
          </tr>
          <tr>
            <td>987654321098</td><td>Maria Santos</td><td>HUMSS</td><td>Female</td>
            <td><button class="btn btn-success btn-sm approve">Approve</button><button class="btn btn-danger btn-sm decline">Decline</button></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Masterlist -->
    <div id="masterlist" class="section">
      <h2>üìë Masterlist</h2>
      <div id="masterlistContent">
        <h5>ABM</h5><ul id="abmList"></ul>
        <h5>HUMSS</h5><ul id="humssList"></ul>
        <h5>TVL-ICT</h5><ul id="ictList"></ul>
        <h5>Bread & Pastry</h5><ul id="breadList"></ul>
      </div>

      <!-- Export Buttons -->
      <div class="export-buttons">
        <button class="btn btn-outline-primary" onclick="exportExcel()">üìä Export to Excel</button>
        <button class="btn btn-outline-danger" onclick="exportPDF()">üìÑ Export to PDF</button>
        <button class="btn btn-outline-success" onclick="exportCSV()">üìù Export to CSV</button>
      </div>
    </div>

    <!-- Messages -->
    <div id="messages" class="section">
      <h2> Messages</h2>
      <table class="table table-striped">
        <thead class="thead-light"><tr><th>Email</th><th>Message</th><th>Date</th></tr></thead>
        <tbody>
          <tr><td>student1@email.com</td><td>Can I still enroll after the deadline?</td><td>Aug 28, 2025</td></tr>
          <tr><td>student2@email.com</td><td>Where can I find my section list?</td><td>Aug 29, 2025</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Approve / Decline
    document.querySelectorAll(".approve").forEach(btn => {
      btn.addEventListener("click", function () {
        let row = this.closest("tr");
        let lrn = row.cells[0].innerText;
        let name = row.cells[1].innerText;
        let track = row.cells[2].innerText;
        let gender = row.cells[3].innerText;

        // Add to Masterlist
        let listId = track.toLowerCase() + "List";
        let targetList = document.getElementById(listId);
        if (targetList) {
          let li = document.createElement("li");
          li.innerText = `${name} (${lrn}) - ${gender}`;
          targetList.appendChild(li);
        }

        // Update Dashboard
        document.getElementById("totalEnrollees").innerText++;
        if (gender === "Male") document.getElementById("maleCount").innerText++;
        else document.getElementById("femaleCount").innerText++;

        row.remove();
      });
    });

    document.querySelectorAll(".decline").forEach(btn => {
      btn.addEventListener("click", function () { this.closest("tr").remove(); });
    });

    // Export Functions
    function collectMasterlist() {
      let data = [];
      document.querySelectorAll("#masterlistContent h5").forEach(section => {
        let track = section.innerText;
        let ul = section.nextElementSibling;
        ul.querySelectorAll("li").forEach(li => {
          data.push({ Track: track, Student: li.innerText });
        });
      });
      return data;
    }

    function exportExcel() {
      let data = collectMasterlist();
      let ws = XLSX.utils.json_to_sheet(data);
      let wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Masterlist");
      XLSX.writeFile(wb, "Masterlist.xlsx");
    }

    async function exportPDF() {
      const { jsPDF } = window.jspdf;
      let doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("FBNHS-SHS Masterlist", 10, 10);
      let y = 20;
      collectMasterlist().forEach(row => {
        doc.text(`${row.Track}: ${row.Student}`, 10, y);
        y += 8;
      });
      doc.save("Masterlist.pdf");
    }

    function exportCSV() {
      let data = collectMasterlist();
      let csv = "Track,Student\n";
      data.forEach(r => { csv += `${r.Track},"${r.Student}"\n`; });
      let blob = new Blob([csv], { type: "text/csv" });
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "Masterlist.csv";
      link.click();
    }
  </script>
</body>
</html>
